# 添加行程安排功能实现说明

## 功能概述

在"行程详情"页面实现了"添加安排"功能，允许用户为行程的特定天数添加地点安排。

## 实现内容

### 1. 前端API接口
在 `src/api/index.ts` 中添加了以下接口：
- `getPlaceSuggestions(tripId, query)` - 获取地点建议
- `addPlaceToTrip(tripId, data)` - 添加地点到行程
- `getPlaceDetail(tripId, placeId)` - 获取地点详情

### 2. 用户界面
在 `src/views/trips/TripDetail.vue` 中实现了：
- 添加安排按钮
- 添加安排对话框
- 地点搜索和选择功能
- 天数选择功能

### 3. 功能特性
- ✅ **智能天数计算**: 根据行程开始和结束日期自动计算可用天数
- ✅ **地点搜索**: 支持输入关键词搜索地点，提供自动完成建议
- ✅ **地点选择**: 从搜索结果中选择具体地点
- ✅ **天数选择**: 选择将地点安排到第几天
- ✅ **表单验证**: 必填字段验证
- ✅ **状态管理**: 加载状态显示和错误处理
- ✅ **实时更新**: 添加成功后自动刷新行程详情

## 数据流程

### 1. 地点搜索流程
1. 用户输入地点名称
2. 前端调用 `getPlaceSuggestions` 接口
3. 后端调用百度地图API获取地点建议
4. 返回地点列表供用户选择

### 2. 添加安排流程
1. 用户选择天数和地点
2. 前端验证表单数据
3. 调用 `addPlaceToTrip` 接口
4. 后端将地点添加到指定天数
5. 前端刷新行程详情显示新添加的安排

## 后端接口说明

### 地点建议接口
```
GET /api/trips/{tripId}/places/suggestion?query={keyword}
返回: [{ uid: string, name: string }]
```

### 添加地点接口
```
POST /api/trips/{tripId}/places/add
请求体: { uid: string, day: number }
返回: { id: number, name: string, type: string, lat: number, lng: number }
```

## 用户体验

### 对话框界面
- **天数选择**: 下拉框显示"第X天 (MM-DD)"格式
- **地点搜索**: 自动完成输入框，支持实时搜索
- **地点预览**: 选择地点后显示地点信息预览
- **操作按钮**: 取消和添加按钮，添加时显示加载状态

### 交互流程
1. 点击"添加安排"按钮打开对话框
2. 选择要安排的天数
3. 输入地点名称进行搜索
4. 从建议列表中选择地点
5. 确认添加，系统自动刷新页面

## 技术实现

### 前端技术
- Vue 3 Composition API
- Element Plus 组件库
- 自动完成搜索组件
- 表单验证和状态管理

### 后端集成
- 百度地图API地点搜索
- 地点数据存储和管理
- 行程-地点关联关系

### 数据结构
```typescript
// 添加安排表单
interface ItineraryForm {
  day: number        // 第几天
  placeName: string  // 地点名称
  placeUid: string   // 地点唯一标识
}

// 地点建议
interface PlaceSuggestion {
  uid: string   // 地点唯一标识
  name: string  // 地点名称
}
```

## 扩展功能

当前实现的是基础版本，后续可以扩展：
- 地点详情显示（地址、电话、评分等）
- 地点类型筛选（景点、餐厅、酒店等）
- 地点排序和拖拽调整
- 地点时间安排（具体时间段）
- 地点预算设置
- 地点图片和描述

## 注意事项

- 地点搜索依赖百度地图API，需要网络连接
- 添加的地点会按天数分组显示在行程安排中
- 用户只能为自己参与的行程添加安排
- 天数计算基于行程的开始和结束日期